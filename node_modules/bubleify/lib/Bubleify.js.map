{"version":3,"sources":["../src/Bubleify.js"],"names":["Bubleify","filename","options","_data","_filename","_options","buf","enc","cb","result","_bubleOptions","code","sourceMap","EOL","map","toUrl","emit","push","err","bubleError","snippet","message","defaults","source","Object","assign","transforms","modules","target","_flags","extensions","_","Transform","Array","isArray","enrishedOptions","shouldIgnoreFile","indexOf"],"mappings":";;;;;;;;AAAA;;AACA;;AACA;;AACA;;;;;;;;IAEMA,Q;;;AACJ,oBAAYC,QAAZ,EAAsBC,OAAtB,EAA+B;AAAA;;AAAA;;AAE7B,UAAKC,KAAL,GAAa,EAAb;AACA,UAAKC,SAAL,GAAiBH,QAAjB;AACA,UAAKI,QAAL,GAAgBH,OAAhB;AAJ6B;AAK9B;;;;+BAqBUI,G,EAAKC,G,EAAKC,E,EAAI;AACvB,WAAKL,KAAL,IAAcG,GAAd;AACAE;AACD;;;2BAEMA,E,EAAI;AACT,UAAI;AACF,YAAMC,SAAS,sBAAU,KAAKN,KAAf,EAAsB,KAAKO,aAA3B,CAAf;AADE,YAEIC,IAFJ,GAEaF,MAFb,CAEIE,IAFJ;;;AAIF,YAAI,KAAKN,QAAL,CAAcO,SAAlB,EAA6B;AAC3B;AACAD,kBAAWE,OAAX,6BAAsCJ,OAAOK,GAAP,CAAWC,KAAX,EAAtC;AACD;;AAED,aAAKC,IAAL,CAAU,UAAV,EAAsBP,MAAtB,EAA8B,KAAKL,SAAnC;AACA,aAAKa,IAAL,CAAUN,IAAV;AACD,OAXD,CAWE,OAAOO,GAAP,EAAY;AACZ;AACA,YAAI,KAAKb,QAAL,CAAcc,UAAd,IAA4BD,IAAIE,OAApC,EAA6C;AAC3C,eAAKJ,IAAL,CAAU,OAAV,UAAyBH,OAAzB,GAA+BK,IAAIE,OAAnC,GAA6CP,OAA7C,GAAmDA,OAAnD,GAAyDK,IAAIG,OAA7D,GAAuER,OAAvE;AACD,SAFD,MAEO;AACL,eAAKG,IAAL,CAAU,OAAV,EAAmBE,GAAnB;AACD;AACD;AACD;AACDV;AACD;;;wBA9CmB;AAClB,UAAMc,WAAW,EAAEC,QAAQ,KAAKnB,SAAf,EAAjB;AACA,UAAMF,UAAUsB,OAAOC,MAAP,CAAcH,QAAd,EAAwB,KAAKjB,QAA7B,CAAhB;;AAEA;AACA;AACAH,cAAQwB,UAAR,GAAqBF,OAAOC,MAAP,CAAc,EAAEE,SAAS,KAAX,EAAd,EAAkC,KAAKtB,QAAL,CAAcqB,UAAhD,CAArB;AACAxB,cAAQ0B,MAAR,GAAiBJ,OAAOC,MAAP,CAAc,EAAd,EAAkB,KAAKpB,QAAL,CAAcuB,MAAhC,CAAjB;;AAEA;AACA,aAAO1B,QAAQ2B,MAAf;AACA,aAAO3B,QAAQU,SAAf;AACA,aAAOV,QAAQ4B,UAAf;AACA,aAAO5B,QAAQiB,UAAf;AACA,aAAOjB,QAAQ0B,MAAR,CAAeG,CAAtB;;AAEA,aAAO7B,OAAP;AACD;;;;EAzBoB8B,iB;;kBAyDR,UAAC/B,QAAD,EAAWC,OAAX,EAAuB;AACpC;AADoC,4BAEkBA,OAFlB,CAE9B4B,UAF8B;AAAA,MAE9BA,UAF8B,uCAEjB,CAAC,KAAD,EAAQ,MAAR,EAAgB,KAAhB,EAAuB,MAAvB,CAFiB;AAGpC;;AACAA,eAAaG,MAAMC,OAAN,CAAcJ,UAAd,IAA4BA,UAA5B,GAAyC,CAACA,UAAD,CAAtD;;AAEA,MAAMK,kBAAkBX,OAAOC,MAAP,CAAc;AACpCb,eAAW,IADyB;AAEpCO,gBAAY;AAFwB,GAAd,EAGrBjB,OAHqB,EAGZ,EAAE4B,sBAAF,EAHY,CAAxB;;AAKA,MAAMM,mBAAmBN,WAAWO,OAAX,CAAmB,mBAAQpC,QAAR,CAAnB,MAA0C,CAAC,CAApE;AACA;AACA,MAAImC,gBAAJ,EAAsB;AACpB;AACA,WAAO,0BAAP;AACD;;AAED,SAAO,IAAIpC,QAAJ,CAAaC,QAAb,EAAuBkC,eAAvB,CAAP;AACD,C","file":"Bubleify.js","sourcesContent":["import { transform } from 'buble';\nimport { Transform, PassThrough } from 'stream';\nimport { EOL } from 'os';\nimport { extname } from 'path';\n\nclass Bubleify extends Transform {\n  constructor(filename, options) {\n    super();\n    this._data = '';\n    this._filename = filename;\n    this._options = options;\n  }\n\n  get _bubleOptions() {\n    const defaults = { source: this._filename };\n    const options = Object.assign(defaults, this._options);\n\n    // copy properties to not modify the existing objects\n    // set default transforms with deactivated modules\n    options.transforms = Object.assign({ modules: false }, this._options.transforms);\n    options.target = Object.assign({}, this._options.target);\n\n    // remove browserify options\n    delete options._flags;\n    delete options.sourceMap;\n    delete options.extensions;\n    delete options.bubleError;\n    delete options.target._;\n\n    return options;\n  }\n\n  _transform(buf, enc, cb) {\n    this._data += buf;\n    cb();\n  }\n\n  _flush(cb) {\n    try {\n      const result = transform(this._data, this._bubleOptions);\n      let { code } = result;\n\n      if (this._options.sourceMap) {\n        // append sourcemaps to code\n        code += `${EOL}//# sourceMappingURL=${result.map.toUrl()}`;\n      }\n\n      this.emit('bubleify', result, this._filename);\n      this.push(code);\n    } catch (err) {\n      // emit buble error message instead of the default error\n      if (this._options.bubleError && err.snippet) {\n        this.emit('error', `---${EOL}${err.snippet}${EOL}${EOL}${err.message}${EOL}`);\n      } else {\n        this.emit('error', err);\n      }\n      return;\n    }\n    cb();\n  }\n}\n\nexport default (filename, options) => {\n  // get extensions or defaults\n  let { extensions = ['.js', '.jsx', '.es', '.es6'] } = options;\n  // convert to json\n  extensions = Array.isArray(extensions) ? extensions : [extensions];\n\n  const enrishedOptions = Object.assign({\n    sourceMap: true,\n    bubleError: false,\n  }, options, { extensions });\n\n  const shouldIgnoreFile = extensions.indexOf(extname(filename)) === -1;\n  // return empty stream for files that should not be transformed\n  if (shouldIgnoreFile) {\n    // eslint-disable-next-line new-cap\n    return PassThrough();\n  }\n\n  return new Bubleify(filename, enrishedOptions);\n};\n"]}